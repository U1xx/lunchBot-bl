# ランチ候補選択Slack Bot

Google Driveのスプレッドシートからランダムにお店を選んでSlack Botでランチ候補を告知し、テイクアウト注文を取りまとめるシステムです。

## 機能

- Google Sheetsからお店一覧を取得
- ランダムに1つのお店を自動選択
- Slackチャンネルに通知
- 定期実行（平日9時）
- 手動実行（管理画面から）
- **テイクアウト注文の取りまとめ**
- **ネット注文サイトへのリンク表示**
- **福井県内の店舗データ事前登録済み**

## セットアップ

### 1. 環境変数の設定

以下の環境変数を設定してください：

- `GOOGLE_SHEETS_API_KEY`: Google Sheets APIキー（オプション）
- `SLACK_BOT_TOKEN`: Slack Botトークン（xoxb-で始まる）
- `SLACK_CHANNEL_ID`: 通知を送信するSlackチャンネルID
- `GOOGLE_SHEET_ID`: スプレッドシートのID（オプション）

### 2. 事前登録済み店舗データ

**福井県内に店舗があるチェーン店（20店舗）:**
- 松屋、すき家、吉野家、なか卯
- ガスト、サイゼリヤ
- ココイチ、丸亀製麺、はなまるうどん
- ケンタッキー、マクドナルド、モスバーガー
- 餃子の王将、リンガーハット、一風堂
- スターバックス、ドトール、コメダ珈琲店
- びっくりドンキー、かっぱ寿司

**福井県のローカル店舗（8店舗）:**
- 8番らーめん（北陸発祥の野菜らーめん）
- ヨーロッパ軒（福井名物ソースカツ丼）
- 秋吉（福井発祥の焼き鳥チェーン）
- とんかつ政ちゃん
- らーめん神月
- 福そば
- 越前そば
- 若狭家（若狭湾の海鮮料理）

### 3. Slack Botの設定

1. Slack APIでアプリを作成
2. Bot Tokenを取得
3. 必要な権限を設定：
   - `chat:write`
   - `chat:write.public`

### 4. スプレッドシートの形式（オプション）

Google Sheetsを使用する場合のスプレッドシート形式：

| A列（name） | B列（genre） | C列（address） | D列（url） | E列（orderUrl） |
|-------------|--------------|----------------|------------|-----------------|
| お店の名前   | ジャンル      | 住所           | 詳細URL    | 注文サイトURL   |

**注意:** Google Sheetsを使用しなくても、事前登録済みの28店舗から自動選択されます。

### 5. デプロイ

#### Vercelの場合（推奨）

1. GitHubリポジトリをVercelに接続
2. 環境変数を設定
3. 自動デプロイ

#### Cloudflare Pagesの場合

1. GitHubリポジトリをCloudflare Pagesに接続
2. 環境変数を設定
3. 自動デプロイ

## 使い方

### 基本的な流れ

1. **ランチ候補の選択**（平日9:00自動 or 手動）
   - 福井県内の28店舗からランダム選択
   - 履歴を考慮した重複回避機能付き

2. **メニュー投稿期間**（AM11:00まで）
   - チームメンバーがSlackに希望メニューを投稿

3. **注文取りまとめ**（手動ボタンクリック）
   - 投稿されたメニューを自動集計

4. **ネット注文実行**（取りまとめ結果のリンクから）
   - 各店舗の注文サイトに直接アクセス

### すぐに使える状態

**Google Sheetsなしでも動作:**
- 設定不要で28店舗から自動選択
- 福井県内の主要チェーン店 + ローカル店舗

**Google Sheetsと併用も可能:**
- 独自の店舗データ + 事前登録データ
- 重複は自動除去

### 手動実行

1. デプロイされたアプリの管理画面にアクセス
2. 「ランチを選ぶ」ボタンをクリック

### API経由

\`\`\`bash
# 手動実行
curl -X POST https://your-domain.com/api/lunch-picker

# 定期実行確認
curl https://your-domain.com/api/cron/lunch

# 注文取りまとめ
curl -X POST https://your-domain.com/api/collect-orders
\`\`\`

### 定期実行

- 平日の9:00に自動実行
- Vercel Cron Jobsを使用

## 注文取りまとめ機能

### メニュー投稿例

\`\`\`
ソースカツ丼 x1 (ヨーロッパ軒)
野菜らーめん x2 (8番らーめん)
焼き鳥定食 x1 (秋吉)
\`\`\`

### 取りまとめ結果例

\`\`\`
📋 **8番らーめん** 注文取りまとめ

📅 日時: 2025/1/19
👥 注文者数: 3名
📦 総注文数: 4個

**📋 メニュー別集計:**
• 野菜らーめん: 3個
  └ 田中太郎(1), 鈴木次郎(2)
• チャーシューメン: 1個
  └ 佐藤花子(1)

🛒 ネット注文: https://www.hachiban.jp/menu/
\`\`\`

## 福井県の特色

### 地域特産メニュー
- **ソースカツ丼**: ヨーロッパ軒の名物
- **越前そば**: 福井の郷土料理
- **野菜らーめん**: 8番らーめんの看板メニュー
- **若狭の海鮮**: 日本海の新鮮な魚介類

### ローカルチェーン
- **8番らーめん**: 北陸発祥、野菜たっぷり
- **秋吉**: 福井発祥の焼き鳥チェーン
- **ヨーロッパ軒**: ソースカツ丼の元祖

## トラブルシューティング

### よくある問題

1. **Slack送信エラー**
   - Bot Tokenが正しく設定されているか確認
   - チャンネルIDが正しいか確認
   - Botがチャンネルに招待されているか確認

2. **店舗データが表示されない**
   - 事前登録データは自動で利用可能
   - Google Sheetsは任意設定

3. **注文サイトリンクが表示されない**
   - 一部店舗は電話注文のみの場合があります
   - 事前登録データには主要チェーン店のリンクを含んでいます

## ライセンス

MIT License
